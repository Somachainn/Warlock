<!DOCTYPE html>
<html lang="so">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Laam wallet</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stellar-sdk/10.4.0/stellar-sdk.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<!-- Add Chart.js for beautiful charts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root{
    /* Blue & White Theme */
    --bg1:#eef2f3; --bg2:#8e9eab;
    --card:rgba(255, 255, 255, 0.9);
    --text:#0a192f; --muted:#546e7a;
    --brand:#0052cc; --brand2:#0041a3; --line:#d0d8e0;
    --ok:#28a745; --warn:#ffc107; --err:#dc3545;
    --maxw: 920px; --rad:16px;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
    color:var(--text);
    background:linear-gradient(135deg,#b8c6db,#f5f7fa);
    min-height:100vh; display:flex; align-items:center; justify-content:center; padding:24px 14px;
  }
  .app{ width:100%; max-width:450px; text-align:center; }
  
  /* Logo and Header Styles */
  .logo-container{ 
    display:flex; 
    align-items:center; 
    justify-content:center; 
    gap:15px; 
    margin-bottom:40px; 
  }
  .logo-container img{ 
    width:80px; 
    height:80px; 
    border-radius:50%;
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
  }
  h1{ 
    margin:0; 
    font-size:3rem; 
    font-weight:800; 
    color:#1976d2; 
    text-shadow:1px 1px 2px rgba(0,0,0,0.1); 
  }
  
  /* Import Card Styles */
  .import-card{
    background:rgba(255, 255, 255, 0.95);
    border:none;
    border-radius:24px;
    box-shadow:0 8px 32px rgba(0,0,0,0.12);
    padding:40px 30px;
    margin:0 auto;
    backdrop-filter:blur(10px);
    max-width:100%;
  }
  
  .form-group{
    margin-bottom:24px;
    text-align:left;
  }
  
  .form-label{
    display:block;
    font-size:18px;
    font-weight:700;
    color:#1976d2;
    margin-bottom:12px;
  }
  
  .form-input{
    width:100%;
    padding:20px;
    border:2px solid #e0e0e0;
    border-radius:16px;
    font-size:16px;
    background:#f8f9fa;
    color:#333;
    outline:none;
    transition:all 0.3s ease;
    font-family:'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
  }
  
  .form-input:focus{
    border-color:#1976d2;
    background:white;
    box-shadow:0 0 0 4px rgba(25,118,210,0.1);
  }
  
  .form-input::placeholder{
    color:#bbb;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
  }
  
  .import-button{
    width:100%;
    padding:20px;
    background:#1976d2;
    color:white;
    border:none;
    border-radius:16px;
    font-size:18px;
    font-weight:700;
    text-transform:uppercase;
    letter-spacing:1px;
    cursor:pointer;
    transition:all 0.3s ease;
    box-shadow:0 4px 16px rgba(25,118,210,0.3);
    margin-top:16px;
  }
  
  .import-button:hover{
    background:#1565c0;
    box-shadow:0 6px 20px rgba(25,118,210,0.4);
    transform:translateY(-2px);
  }
  
  .divider{
    margin:32px 0;
    text-align:center;
    position:relative;
  }
  
  .divider::before{
    content:'';
    position:absolute;
    top:50%;
    left:0;
    right:0;
    height:1px;
    background:#e0e0e0;
  }
  
  .divider-text{
    background:rgba(255, 255, 255, 0.95);
    padding:0 16px;
    color:#666;
    font-size:14px;
    font-weight:500;
  }
  
  .generate-link{
    text-align:center;
  }
  
  .generate-button{
    color:#1976d2;
    text-decoration:underline;
    background:none;
    border:none;
    cursor:pointer;
    font-size:16px;
    font-weight:600;
    transition:color 0.3s ease;
    text-transform:none;
    padding:0;
    width:auto;
    box-shadow:none;
  }
  
  .generate-button:hover{
    color:#1565c0;
    transform:none;
    box-shadow:none;
  }
  
  .note-text{
    font-size:12px;
    color:#666;
    margin-top:8px;
    line-height:1.4;
  }

  /* Key Display Modal */
  .key-modal{
    display:none;
    position:fixed;
    inset:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.5);
    z-index:1000;
    align-items:center;
    justify-content:center;
  }
  .key-modal.show{
    display:flex;
  }
  .key-modal-content{
    background:rgba(255, 255, 255, 0.95);
    border:none;
    border-radius:24px;
    box-shadow:0 8px 32px rgba(0,0,0,0.12);
    padding:40px 30px;
    max-width:500px;
    width:90%;
    max-height:90vh;
    overflow-y:auto;
    backdrop-filter:blur(10px);
  }
  .key-modal-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:30px;
  }
  .key-modal-title{
    font-size:1.8rem;
    font-weight:700;
    color:#1976d2;
    margin:0;
  }
  .key-modal-close{
    background:none;
    border:none;
    font-size:2rem;
    cursor:pointer;
    color:#666;
    padding:0;
    width:auto;
    height:auto;
    box-shadow:none;
    text-transform:none;
  }
  .key-modal-close:hover{
    color:#333;
    transform:none;
    box-shadow:none;
  }
  .key-display-group{
    margin-bottom:30px;
  }
  .key-display-label{
    display:block;
    font-size:16px;
    font-weight:700;
    color:#1976d2;
    margin-bottom:12px;
  }
  .key-display-container{
    position:relative;
    display:flex;
    align-items:center;
  }
  .key-display-input{
    width:100%;
    padding:15px 60px 15px 15px;
    border:2px solid #e0e0e0;
    border-radius:12px;
    font-size:14px;
    background:#f8f9fa;
    color:#333;
    font-family:'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
    word-break:break-all;
    resize:none;
  }
  .copy-btn{
    position:absolute;
    right:10px;
    background:#1976d2;
    color:white;
    border:none;
    border-radius:8px;
    padding:8px 12px;
    font-size:12px;
    font-weight:600;
    cursor:pointer;
    transition:all 0.3s ease;
    text-transform:uppercase;
    box-shadow:0 2px 8px rgba(25,118,210,0.3);
  }
  .copy-btn:hover{
    background:#1565c0;
    box-shadow:0 4px 12px rgba(25,118,210,0.4);
    transform:translateY(-1px);
  }
  .copy-btn.copied{
    background:#28a745;
    box-shadow:0 2px 8px rgba(40,167,69,0.3);
  }
  .warning-text{
    background:#fff3cd;
    border:1px solid #ffeaa7;
    border-radius:12px;
    padding:15px;
    margin:20px 0;
    color:#856404;
    font-size:14px;
    line-height:1.5;
  }
  .use-account-btn{
    width:100%;
    padding:15px;
    background:#28a745;
    color:white;
    border:none;
    border-radius:12px;
    font-size:16px;
    font-weight:700;
    text-transform:uppercase;
    cursor:pointer;
    transition:all 0.3s ease;
    box-shadow:0 4px 16px rgba(40,167,69,0.3);
  }
  .use-account-btn:hover{
    background:#218838;
    box-shadow:0 6px 20px rgba(40,167,69,0.4);
    transform:translateY(-2px);
  }

  /* Main Card Styles */
  .card{
    background:var(--card); border:1px solid var(--line); border-radius:var(--rad);
    box-shadow:0 10px 30px rgba(0,0,0,0.1); padding:22px; margin:14px auto;
  }
  .grid-2{ display:grid; grid-template-columns:1fr 1fr; gap:16px; }
  @media (max-width:820px){ .grid-2{ grid-template-columns:1fr; } }
  label{ display:block; text-align:left; margin:8px 0 6px; font-weight:600; color:var(--brand); }
  input,select,button{
    width:100%; padding:12px 14px; border:1px solid var(--line); border-radius:12px; font-size:1rem;
    background:#f8f9fa; color:var(--text); outline:none; transition:border-color .2s ease;
  }
  input:focus{ border-color:var(--brand); }
  button{
    background:var(--brand); color:#fff; font-weight:700; letter-spacing:.02em; border:none;
    box-shadow:0 4px 14px rgba(0,82,204,0.3); cursor:pointer; text-transform:uppercase; transition:all .2s ease;
  }
  button:hover{ background:var(--brand2); box-shadow:0 6px 18px rgba(0,65,163,0.4); transform:translateY(-2px); }
  button:disabled{ background:#b0bec5; cursor:not-allowed; box-shadow:none; transform:none; }
  .btn-secondary{ background:#6c757d; color:#fff; box-shadow:0 4px 14px rgba(0,0,0,0.1); }
  .btn-secondary:hover{ background:#5a6268; }
  .btn-danger{ background:var(--err); color:#fff; box-shadow:0 4px 14px rgba(220,53,69,0.3); }
  .btn-danger:hover{ background:#c82333; }
  .mono{
    font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;
    background:#e9ecef; padding:10px 12px; border-radius:12px; overflow-wrap:anywhere; color:#343a40;
  }
  .muted{ color:var(--muted); font-size:.92rem; }
  .balances{ display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap; }
  .pill{ background:#e9ecef; border:1px solid var(--line); padding:8px 14px; border-radius:999px; font-weight:600; }
  .hidden{ display:none; }
  .send-wrap{ display:none; margin-top:16px; text-align:left; border-top:1px solid var(--line); padding-top:16px; }
  .send-row{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
  @media (max-width:640px){ .send-row{ grid-template-columns:1fr; } }

  /* Trade Section Styles */
  .trade-card{ padding:0; overflow:hidden; }
  .trade-header{ display:flex; justify-content:space-between; align-items:center; padding:16px 20px; border-bottom:1px solid var(--line); }
  .trade-header h3{ margin:0; font-size:1.2rem; }
  .trade-header .icon{ font-size:1.5rem; cursor:pointer; transition:color 0.3s ease; }
  .trade-header .icon:hover{ color:var(--brand); }
  .trade-asset-selector{ display:flex; align-items:center; justify-content:space-between; padding:16px 20px; background:#f8f9fa; }
  .asset-box{ display:flex; align-items:center; gap:8px; }
  .asset-box img{ width:24px; height:24px; border-radius:50%; }
  .asset-box .asset-name{ font-weight:600; }
  .asset-box .asset-issuer{ font-size:.8rem; color:var(--muted); }
  .swap-icon{ font-size:1.5rem; background:#fff; border-radius:50%; padding:5px; border:1px solid var(--line); cursor:pointer; transition:all 0.3s ease; }
  .swap-icon:hover{ background:var(--brand); color:#fff; transform:rotate(180deg); }
  .trade-tabs{ display:flex; border-bottom:1px solid var(--line); background:#f8f9fa; }
  .trade-tabs .tab{ 
    flex:1; padding:12px; text-align:center; cursor:pointer; font-weight:600; 
    color:var(--muted); border-bottom:3px solid transparent; 
    transition:all 0.3s ease; position:relative;
  }
  .trade-tabs .tab:hover{ background:rgba(0,82,204,0.1); color:var(--brand); }
  .trade-tabs .tab.active{ color:var(--brand); border-bottom-color:var(--brand); background:#fff; }
  .tab-content{ display:none; }
  .tab-content.active{ display:block; }
  .overview-content{ padding:20px; text-align:center; }
  .price-display{ font-size:2.5rem; font-weight:bold; margin-bottom:10px; color:var(--brand); }
  .price-change{ font-size:1rem; margin-bottom:20px; }
  .price-change.positive{ color:var(--ok); }
  .price-change.negative{ color:var(--err); }
  .chart-timeframes{ display:flex; justify-content:center; gap:10px; margin-bottom:20px; }
  .timeframe-btn{ 
    padding:8px 15px; border-radius:8px; border:1px solid var(--line); 
    background:#f8f9fa; color:var(--text); cursor:pointer; transition:all 0.3s ease;
    font-size:0.9rem; font-weight:600;
  }
  .timeframe-btn:hover, .timeframe-btn.active{ background:var(--brand); color:#fff; border-color:var(--brand); }
  .chart-container {
    width:100%; 
    height:200px; 
    margin-bottom:20px;
    position: relative;
  }
  .market-stats{ display:grid; grid-template-columns:1fr 1fr; gap:15px; text-align:left; }
  .stat-item{ background:#f8f9fa; padding:12px; border-radius:8px; border:1px solid var(--line); }
  .stat-label{ font-size:0.8rem; color:var(--muted); margin-bottom:4px; }
  .stat-value{ font-weight:600; color:var(--text); }
  .orderbook-content{ padding:10px 20px 20px; }
  .orderbook-table{ width:100%; border-collapse:collapse; margin-bottom:10px; }
  .orderbook-table th,.orderbook-table td{ text-align:right; padding:8px 4px; font-size:.9rem; }
  .orderbook-table th{ color:var(--muted); font-weight:600; border-bottom:2px solid var(--line); }
  .orderbook-table th:first-child,.orderbook-table td:first-child{ text-align:left; }
  .orderbook-table .bid-row{ cursor:pointer; transition:background 0.2s ease; }
  .orderbook-table .bid-row:hover{ background:rgba(40,167,69,0.1); }
  .orderbook-table .bid-row td:nth-child(2){ color:var(--ok); font-weight:600; }
  .orderbook-table .ask-row{ cursor:pointer; transition:background 0.2s ease; }
  .orderbook-table .ask-row:hover{ background:rgba(220,53,69,0.1); }
  .orderbook-table .ask-row td:nth-child(2){ color:var(--err); font-weight:600; }
  .spread{ 
    padding:12px 0; text-align:center; font-weight:bold; 
    border-top:1px solid var(--line); border-bottom:1px solid var(--line); 
    margin:8px 0; background:#f8f9fa; border-radius:8px;
  }
  .trades-content{ padding:10px 20px 20px; }
  .trades-table{ width:100%; border-collapse:collapse; }
  .trades-table th,.trades-table td{ text-align:right; padding:8px 4px; font-size:.9rem; }
  .trades-table th{ color:var(--muted); font-weight:600; border-bottom:2px solid var(--line); }
  .trades-table th:first-child,.trades-table td:first-child{ text-align:left; }
  .trade-buy{ color:var(--ok); }
  .trade-sell{ color:var(--err); }
  .trade-time{ color:var(--muted); font-size:0.8rem; }
  .trade-actions{ display:flex; gap:15px; padding:20px; background:#f8f9fa; border-top:1px solid var(--line); }
  .trade-actions button{ 
    flex:1; padding:16px; font-size:1.1rem; border-radius:12px; text-transform:uppercase; 
    font-weight:700; transition:all 0.3s ease; position:relative; overflow:hidden;
  }
  .trade-actions button:before{
    content:''; position:absolute; top:0; left:-100%; width:100%; height:100%;
    background:linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition:left 0.5s; z-index:1;
  }
  .trade-actions button:hover:before{ left:100%; }
  .btn-buy{ background:var(--ok); box-shadow:0 4px 14px rgba(40,167,69,0.3); }
  .btn-buy:hover{ background:#218838; box-shadow:0 6px 20px rgba(40,167,69,0.4); transform:translateY(-2px); }
  .btn-sell{ background:var(--err); color:#fff; box-shadow:0 4px 14px rgba(220,53,69,0.3); }
  .btn-sell:hover{ background:#c82333; box-shadow:0 6px 20px rgba(220,53,69,0.4); transform:translateY(-2px); }
  .loading-spinner{ 
    display:inline-block; width:20px; height:20px; 
    border:3px solid #f3f3f3; border-top:3px solid var(--brand); 
    border-radius:50%; animation:spin 1s linear infinite; 
  }
  @keyframes spin{ 0%{ transform:rotate(0deg); } 100%{ transform:rotate(360deg); } }

  /* My Offers Section Styles */
  .my-offers-section{
    background:var(--card); 
    border:1px solid var(--line); 
    border-radius:var(--rad);
    box-shadow:0 10px 30px rgba(0,0,0,0.1); 
    margin:14px auto;
    overflow:hidden;
  }
  .my-offers-header{
    display:flex; 
    justify-content:space-between; 
    align-items:center; 
    padding:16px 20px; 
    border-bottom:1px solid var(--line);
    background:#f8f9fa;
  }
  .my-offers-header h3{
    margin:0; 
    font-size:1.2rem; 
    color:var(--brand);
    font-weight:700;
  }
  .my-offers-content{
    padding:20px;
  }
  .offers-table{
    width:100%; 
    border-collapse:collapse; 
    margin-bottom:15px;
  }
  .offers-table th,
  .offers-table td{
    text-align:left; 
    padding:12px 8px; 
    font-size:.9rem;
    border-bottom:1px solid var(--line);
  }
  .offers-table th{
    color:var(--muted); 
    font-weight:600; 
    background:#f8f9fa;
    text-transform:uppercase;
    font-size:0.8rem;
    letter-spacing:0.5px;
  }
  .offers-table th:last-child,
  .offers-table td:last-child{
    text-align:center;
  }
  .offer-row{
    cursor:pointer; 
    transition:background 0.2s ease;
  }
  .offer-row:hover{
    background:rgba(0,82,204,0.05);
  }
  .offer-type{
    font-weight:700; 
    text-transform:uppercase; 
    font-size:0.8rem;
    padding:4px 8px;
    border-radius:4px;
    display:inline-block;
  }
  .offer-type.buy{
    color:var(--ok);
    background:rgba(40,167,69,0.1);
  }
  .offer-type.sell{
    color:var(--err);
    background:rgba(220,53,69,0.1);
  }
  .offer-amount,
  .offer-price{
    font-family:'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
    font-weight:600;
  }
  .offer-actions{
    display:flex;
    gap:8px;
    justify-content:center;
  }
  .offer-action-btn{
    padding:6px 12px;
    border:none;
    border-radius:6px;
    font-size:0.8rem;
    font-weight:600;
    cursor:pointer;
    transition:all 0.3s ease;
    text-transform:none;
    min-width:auto;
    width:auto;
  }
  .edit-btn{
    background:var(--brand);
    color:white;
    box-shadow:0 2px 8px rgba(25,118,210,0.3);
  }
  .edit-btn:hover{
    background:var(--brand2);
    box-shadow:0 4px 12px rgba(25,118,210,0.4);
    transform:translateY(-1px);
  }
  .delete-btn{
    background:var(--err);
    color:white;
    box-shadow:0 2px 8px rgba(220,53,69,0.3);
  }
  .delete-btn:hover{
    background:#c82333;
    box-shadow:0 4px 12px rgba(220,53,69,0.4);
    transform:translateY(-1px);
  }
  .no-offers{
    text-align:center;
    padding:40px 20px;
    color:var(--muted);
    font-style:italic;
  }

  /* Modal Styles */
  .trade-modal{ display:none; position:fixed; inset:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center; }
  .trade-modal.show{ display:flex; }
  .modal-content{ 
    background:var(--card); border:1px solid var(--line); border-radius:var(--rad); 
    box-shadow:0 20px 40px rgba(0,0,0,0.15); padding:20px; max-width:420px; width:90%; 
    max-height:90vh; overflow-y:auto; animation:modalSlideIn 0.3s ease-out;
  }
  @keyframes modalSlideIn{ from{ opacity:0; transform:translateY(-50px); } to{ opacity:1; transform:translateY(0); } }
  .modal-header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
  .modal-title{ font-size:1.5rem; font-weight:700; color:var(--brand); margin:0; }
  .modal-close{ 
    background:none; border:none; font-size:1.5rem; cursor:pointer; color:var(--muted); 
    padding:5px; width:auto; height:auto; box-shadow:none; text-transform:none; 
    border-radius:50%; transition:all 0.3s ease;
  }
  .modal-close:hover{ color:var(--text); background:rgba(0,0,0,0.1); transform:none; box-shadow:none; }
  .panel{ background:#f8f9fa; border:1px solid var(--line); border-radius:12px; padding:20px; margin:0; }
  .titleRow{ display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
  .title{ font-size:1.2rem; font-weight:700; color:var(--brand); }
  .avail{ font-size:.9rem; color:var(--muted); }
  .field{ margin-bottom:16px; }
  .inputWrap{ position:relative; display:flex; align-items:center; }
  .inputWrap input{ padding-right:60px; margin:0; border:2px solid var(--line); transition:border-color 0.3s ease; }
  .inputWrap input:focus{ border-color:var(--brand); box-shadow:0 0 0 3px rgba(0,82,204,0.1); }
  .unit{ position:absolute; right:15px; color:var(--muted); font-weight:600; pointer-events:none; }
  .hint{ font-size:.85rem; color:var(--muted); margin-top:5px; }
  .rowBtns{ display:flex; gap:8px; margin-top:8px; }
  .rowBtns button{ 
    flex:1; padding:8px; font-size:.85rem; background:#e9ecef; color:var(--text); 
    border:1px solid var(--line); text-transform:none; font-weight:600;
  }
  .rowBtns button:hover{ background:var(--brand); color:#fff; }
  .totalBox{ background:#e9f4ff; border:1px solid #b3d9ff; border-radius:8px; padding:15px; margin:15px 0; }
  .cta{ 
    background:var(--brand); color:#fff; font-weight:700; padding:16px; font-size:1.1rem; 
    border-radius:12px; text-transform:uppercase; letter-spacing:.5px; margin-top:10px;
    box-shadow:0 4px 16px rgba(0,82,204,0.3);
  }
  .cta:hover{ background:var(--brand2); box-shadow:0 6px 20px rgba(0,65,163,0.4); }
  .cta.buy{ background:var(--ok); box-shadow:0 4px 16px rgba(40,167,69,0.3); }
  .cta.buy:hover{ background:#218838; box-shadow:0 6px 20px rgba(40,167,69,0.4); }
  .cta.sell{ background:var(--err); box-shadow:0 4px 16px rgba(220,53,69,0.3); }
  .cta.sell:hover{ background:#c82333; box-shadow:0 6px 20px rgba(220,53,69,0.4); }

  /* My Orders Modal Styles */
  .my-orders-modal{
    display:none;
    position:fixed;
    inset:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.5);
    z-index:1000;
    align-items:center;
    justify-content:center;
  }
  .my-orders-modal.show{
    display:flex;
  }
  .my-orders-modal-content{
    background:var(--card);
    border:1px solid var(--line);
    border-radius:var(--rad);
    box-shadow:0 20px 40px rgba(0,0,0,0.15);
    padding:20px;
    max-width:500px;
    width:90%;
    max-height:90vh;
    overflow-y:auto;
    animation:modalSlideIn 0.3s ease-out;
  }
  .my-orders-modal-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:25px;
  }
  .my-orders-modal-title{
    font-size:1.5rem;
    font-weight:700;
    color:var(--brand);
    margin:0;
  }
  .my-orders-modal-close{
    background:none;
    border:none;
    font-size:1.8rem;
    cursor:pointer;
    color:var(--muted);
    padding:0;
    width:auto;
    height:auto;
    box-shadow:none;
    text-transform:none;
  }
  .my-orders-modal-close:hover{
    color:var(--text);
    transform:none;
    box-shadow:none;
  }
  .orders-list {
    max-height: 300px;
    overflow-y: auto;
    margin-bottom: 20px;
  }
  .order-item {
    display: flex;
    justify-content: space-between;
    padding: 12px;
    border: 1px solid var(--line);
    border-radius: 8px;
    margin-bottom: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  .order-item:hover {
    background-color: #f8f9fa;
  }
  .order-item.selected {
    border-color: var(--brand);
    background-color: rgba(0, 82, 204, 0.1);
  }
  .order-type {
    font-weight: 700;
    text-transform: uppercase;
    font-size: 12px;
  }
  .order-type.buy {
    color: var(--ok);
  }
  .order-type.sell {
    color: var(--err);
  }
  .order-amount, .order-price {
    font-family: 'SF Mono', monospace;
  }
  .order-actions{
    display:flex;
    flex-direction:column;
    gap:15px;
  }
  .order-action-btn{
    width:100%;
    padding:15px;
    border:none;
    border-radius:12px;
    font-size:16px;
    font-weight:600;
    cursor:pointer;
    transition:all 0.3s ease;
    text-transform:none;
  }
  .edit-order-btn{
    background:var(--brand);
    color:white;
    box-shadow:0 4px 16px rgba(25,118,210,0.3);
  }
  .edit-order-btn:hover{
    background:var(--brand2);
    box-shadow:0 6px 20px rgba(25,118,210,0.4);
    transform:translateY(-2px);
  }
  .cancel-order-btn{
    background:var(--err);
    color:white;
    box-shadow:0 4px 16px rgba(220,53,69,0.3);
  }
  .cancel-order-btn:hover{
    background:#c82333;
    box-shadow:0 6px 20px rgba(220,53,69,0.4);
    transform:translateY(-2px);
  }

  /* Animation */
  .import-card {
    animation: slideUp 0.6s ease-out;
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @media (max-width: 480px) {
    .app {
      max-width: 100%;
      padding: 0 10px;
    }
    
    .import-card {
      padding: 30px 20px;
      margin: 10px;
    }
    
    .logo-container img {
      width: 60px;
      height: 60px;
    }
    
    h1 {
      font-size: 2.2rem;
    }

    .key-modal-content {
      padding: 30px 20px;
      margin: 10px;
    }

    .key-display-input {
      font-size: 12px;
      padding: 12px 50px 12px 12px;
    }

    .copy-btn {
      padding: 6px 8px;
      font-size: 10px;
    }

    .market-stats {
      grid-template-columns: 1fr;
    }

    .chart-timeframes {
      flex-wrap: wrap;
    }

    .offers-table th,
    .offers-table td {
      padding: 8px 4px;
      font-size: 0.8rem;
    }

    .offer-actions {
      flex-direction: column;
      gap: 4px;
    }

    .offer-action-btn {
      padding: 4px 8px;
      font-size: 0.7rem;
    }
  }
</style>
</head>
<body>
  <div class="app">
    <div class="logo-container">
      <img src="https://i.ibb.co/r28SP1bN/20250802-225108.png" alt="Laam Logo">
      <h1>Laam wallet</h1>
    </div>

    <!-- AUTH SECTION -->
    <div id="authSection">
      <div class="import-card">
        <div id="unlockView" class="hidden">
          <h3 style="margin:0 0 20px 0; color:#1976d2; text-align:center; font-size:1.5rem;">Unlock Wallet</h3>
          <div class="form-group">
            <label class="form-label" for="walletPassword">Password</label>
            <input class="form-input" id="walletPassword" type="password" placeholder="Enter your password" />
          </div>
          <button class="import-button" id="unlockBtn">Unlock</button>
          <div class="divider">
            <span class="divider-text">or</span>
          </div>
          <div class="generate-link">
            <a href="#" id="resetWalletLink" style="color:#1976d2; text-decoration:none;">Reset and Import New Key</a>
          </div>
        </div>

        <div id="initialView">
          <div class="form-group">
            <label class="form-label" for="secretKeyInput">Secret Key (S...)</label>
            <input class="form-input" id="secretKeyInput" type="password" placeholder="SXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"/>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="savePasswordInput">Create Password to Save</label>
            <input class="form-input" id="savePasswordInput" type="password" placeholder="Min 8 chars"/>
          </div>
          
          <button class="import-button" id="importAndSaveBtn">Import wallet and Save</button>
          
          <div class="divider">
            <span class="divider-text">or</span>
          </div>
          
          <div class="generate-link">
            <button class="generate-button" id="generateAccountBtn">Create new wallet</button>
            <p class="note-text">(xasuuso: waa in aad ku shubtaa wallet kaaga ugu yaraan 4 XLM si uu ufurmo)</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Key Display Modal -->
    <div id="keyModal" class="key-modal">
      <div class="key-modal-content">
        <div class="key-modal-header">
          <h3 class="key-modal-title">New Wallet Account Generated</h3>
          <button class="key-modal-close" onclick="closeKeyModal()">&times;</button>
        </div>
        
        <div class="key-display-group">
          <label class="key-display-label">Secret Key (S...)</label>
          <div class="key-display-container">
            <textarea class="key-display-input" id="generatedSecretKey" readonly rows="3"></textarea>
            <button class="copy-btn" onclick="copyToClipboard('generatedSecretKey', this)">Copy</button>
          </div>
        </div>

        <div class="key-display-group">
          <label class="key-display-label">Public Key (G...)</label>
          <div class="key-display-container">
            <textarea class="key-display-input" id="generatedPublicKey" readonly rows="2"></textarea>
            <button class="copy-btn" onclick="copyToClipboard('generatedPublicKey', this)">Copy</button>
          </div>
        </div>

        <div class="warning-text">
          <strong>⚠️ MUHIIM:</strong> Ku kaydi Secret Key-ga meel ammaan ah! Waad ubaahan doontaa si aad u gasho wallet-kaaga. Haddii aad lumiso, ma heli kartid account-kaaga. Sidoo kale copy dheh public key kaaga oo kushub ugu yaraan 4 XLM si uu wallet kaagu kuugu shaqeeyo.
        </div>

        <button class="use-account-btn" onclick="useGeneratedAccount()">Use This Account</button>
      </div>
    </div>

    <!-- LOGGED IN VIEW -->
    <div id="loggedInView" class="hidden">
      <div class="card">
        <div class="balances">
          <div class="pill">
            <div>XLM: <span id="xlmBal">0.00</span></div>
            <div class="muted" style="font-size:0.8rem;">$<span id="xlmUsd">0.00</span> ($<span id="xlmPrice">0.00</span>/XLM)</div>
          </div>
          <div class="pill">
            <div>Laam: <span id="laamBal">0.00</span></div>
            <div class="muted" style="font-size:0.8rem;">$<span id="laamUsd">0.00</span> ($<span id="laamPrice">0.06</span>/Laam)</div>
          </div>
        </div>
        <label style="margin-top:10px;">Your Public Key</label>
        <div id="pubKey" class="mono">-</div>
        <div style="display:flex; gap:10px; margin-top:16px; justify-content:center;">
          <button id="btnSendToggle">Send</button>
          <button id="addTrustlineBtn">Add Laam Trustline</button>
          <button id="logoutBtn" class="btn-danger">Lock Wallet</button>
        </div>

        <div id="sendForm" class="send-wrap">
          <h4 style="margin:0 0 10px 0; color:var(--brand)">Send Assets</h4>
          <div class="send-row">
            <div><label for="sendAsset">Asset</label><select id="sendAsset"><option value="XLM">XLM</option><option value="LAAM">Laam</option></select></div>
            <div><label for="sendAmount">Amount</label><input id="sendAmount" type="number" step="0.0000001" placeholder="e.g. 10" /></div>
          </div>
          <label for="sendDest" style="margin-top:8px;">Destination Public Key</label>
          <input id="sendDest" type="text" placeholder="G... destination" />
          
          <!-- MEMO FIELD ADDED HERE -->
          <div class="form-group">
            <label for="sendMemo">Memo (Optional)</label>
            <input class="form-input" id="sendMemo" type="text" placeholder="Memo text or ID" />
          </div>
          
          <button id="btnSend" style="margin-top:10px;">Send Now</button>
        </div>
      </div>

      <!-- Enhanced Trade Section -->
      <div class="card trade-card">
        <div class="trade-header">
          <span class="icon">←</span>
          <h3>Trade</h3>
          <span class="icon" id="refreshOB" onclick="openMyOrdersModal()">↻</span>
        </div>
        <div class="trade-asset-selector">
          <div class="asset-box">
            <img src="https://i.ibb.co/r28SP1bN/20250802-225108.png" alt="Laam">
            <div>
              <div class="asset-name">Laam</div>
              <div class="asset-issuer">laam.online</div>
            </div>
          </div>
          <span class="swap-icon" id="swapAssets">⇄</span>
          <div class="asset-box">
            <img src="https://res.coinpaper.com/coinpaper/stellar_xlm_logo_07021d63c0.png" alt="XLM">
            <div>
              <div class="asset-name">XLM</div>
              <div class="asset-issuer">stellar.org</div>
            </div>
          </div>
        </div>
        
        <!-- Enhanced Trade Tabs -->
        <div class="trade-tabs">
          <div class="tab" id="overviewTab">Overview</div>
          <div class="tab active" id="orderbookTab">Orderbook</div>
          <div class="tab" id="lastTradesTab">Last Trades</div>
        </div>
        
        <!-- Overview Tab Content -->
        <div id="overviewContent" class="tab-content">
          <div class="overview-content">
            <div class="price-display">
              <span id="overviewLaamPriceXLM">0.135000</span> XLM
            </div>
            <div class="price-change positive" id="priceChange">+0.005000 (+3.85%)</div>
            
            <div class="chart-timeframes">
              <button class="timeframe-btn active" data-timeframe="1D">1D</button>
              <button class="timeframe-btn" data-timeframe="1W">1W</button>
              <button class="timeframe-btn" data-timeframe="1M">1M</button>
              <button class="timeframe-btn" data-timeframe="1Y">1Y</button>
            </div>
            
            <!-- Chart container for Chart.js -->
            <div class="chart-container">
              <canvas id="priceChart"></canvas>
            </div>
            
            <div class="market-stats">
              <div class="stat-item">
                <div class="stat-label">24h Volume</div>
                <div class="stat-value">12,450 Laam</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">24h High</div>
                <div class="stat-value">0.142000 XLM</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">24h Low</div>
                <div class="stat-value">0.128000 XLM</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">Market Cap</div>
                <div class="stat-value">180,253 XLM</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Orderbook Tab Content -->
        <div id="orderbookContent" class="tab-content active">
          <div class="orderbook-content">
            <table class="orderbook-table">
              <thead><tr><th>Amount (Laam)</th><th>Price (XLM)</th><th>Total (XLM)</th></tr></thead>
              <tbody id="asksBody">
                <tr><td colspan="3" style="text-align:center; padding:20px;"><div class="loading-spinner"></div> Loading...</td></tr>
              </tbody>
            </table>
            <div class="spread" id="spreadValue">Loading spread...</div>
            <table class="orderbook-table">
              <tbody id="bidsBody">
                <tr><td colspan="3" style="text-align:center; padding:20px;"><div class="loading-spinner"></div> Loading...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- Last Trades Tab Content -->
        <div id="lastTradesContent" class="tab-content">
          <div class="trades-content">
            <table class="trades-table">
              <thead><tr><th>Time</th><th>Type</th><th>Price (XLM)</th><th>Amount (Laam)</th></tr></thead>
              <tbody id="tradesBody">
                <tr><td colspan="4" style="text-align:center; padding:20px;"><div class="loading-spinner"></div> Loading...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <div class="trade-actions">
          <button class="btn-buy" id="btnBuy">Buy</button>
          <button class="btn-sell" id="btnSell">Sell</button>
        </div>
      </div>

      <!-- MY OFFERS SECTION -->
      <div class="my-offers-section">
        <div class="my-offers-header">
          <h3>My Offers</h3>
          <span class="icon" onclick="refreshMyOffers()" style="cursor:pointer; font-size:1.2rem;">↻</span>
        </div>
        <div class="my-offers-content">
          <table class="offers-table">
            <thead>
              <tr>
                <th>XLM</th>
                <th>Laam</th>
                <th>Price</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="myOffersBody">
              <tr>
                <td>1.34</td>
                <td>10</td>
                <td>0.134</td>
                <td>
                  <div class="offer-actions">
                    <button class="offer-action-btn edit-btn" onclick="editOffer(1)">✏️</button>
                    <button class="offer-action-btn delete-btn" onclick="deleteOffer(1)">✖️</button>
                  </div>
                </td>
              </tr>
              <tr>
                <td>4.947</td>
                <td>30</td>
                <td>0.1649</td>
                <td>
                  <div class="offer-actions">
                    <button class="offer-action-btn edit-btn" onclick="editOffer(2)">✏️</button>
                    <button class="offer-action-btn delete-btn" onclick="deleteOffer(2)">✖️</button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Trade Modal -->
  <div id="tradeModal" class="trade-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="modalTitle">Buy Laam</h3>
        <button class="modal-close" onclick="closeTradeModal()">&times;</button>
      </div>
      <div class="panel">
        <div class="titleRow">
          <div class="title" id="panelTitle">Buy Laam</div>
          <div class="avail">Available: <span id="availBalance">0 XLM</span></div>
        </div>

        <div class="field">
          <div class="inputWrap">
            <input id="modalPrice" type="number" step="0.0000001" placeholder="0.135000" />
            <div class="unit">XLM</div>
          </div>
          <div class="hint">Price (XLM per Laam)</div>
        </div>

        <div class="field">
          <div class="inputWrap">
            <input id="modalAmount" type="number" step="0.0000001" placeholder="Amount" />
            <div class="unit">Laam</div>
          </div>
          <div class="rowBtns">
            <button data-fill="25">25%</button>
            <button data-fill="50">50%</button>
            <button data-fill="75">75%</button>
            <button data-fill="100">100%</button>
          </div>
        </div>

        <div class="totalBox">
          <div class="inputWrap">
            <input id="modalTotal" type="number" step="0.0000001" placeholder="Total" readonly />
            <div class="unit">XLM</div>
          </div>
          <div class="hint">Total cost</div>
        </div>

        <button class="cta buy" id="modalBuyBtn">Buy Laam</button>
      </div>
    </div>
  </div>

  <!-- My Orders Modal -->
  <div id="myOrdersModal" class="my-orders-modal">
    <div class="my-orders-modal-content">
      <div class="my-orders-modal-header">
        <h3 class="my-orders-modal-title">My Orders</h3>
        <button class="my-orders-modal-close" onclick="closeMyOrdersModal()">&times;</button>
      </div>
      
      <div id="ordersList" class="orders-list">
        <div class="loading-spinner"></div>
      </div>
      
      <div class="order-actions">
        <button class="order-action-btn edit-order-btn" onclick="promptEditOffer()">Edit Order</button>
        <button class="order-action-btn cancel-order-btn" onclick="confirmCancelOffer()">Cancel Order</button>
      </div>
    </div>
  </div>

  <!-- Edit Order Modal -->
  <div id="editOrderModal" class="trade-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Edit Order</h3>
        <button class="modal-close" onclick="closeEditModal()">&times;</button>
      </div>
      <div class="panel">
        <div class="field">
          <label>Amount (Laam)</label>
          <input id="editAmount" type="number" step="0.0001">
        </div>
        <div class="field">
          <label>Price (XLM per Laam)</label>
          <input id="editPrice" type="number" step="0.0000001">
        </div>
        <button class="cta" id="confirmEditBtn">Update Order</button>
      </div>
    </div>
  </div>

  <script>
    // Laam token configuration
    const LAAM_TOKEN = {
      code: "Laam",
      issuer: "GAL4ECDAXNBMJYFCWIJ32HKVIRLCNEXY664CAZYI3EINQWPLXTMEPR64",
      name: "Laam",
      description: "Laam is a limited supply token on Stellar with a maximum of 1,335,577 tokens, issued only once to preserve value.",
      image: "https://i.ibb.co/r28SP1bN/20250802-225108.png",
      maxSupply: 1335577,
      currentPrice: 0.06
    };

    // Global variables
    let currentKeypair = null;
    let server = null;
    let LAAM_ASSET = null;
    let xlmPriceUSD = 0.12;
    let currentTradeMode = 'buy';
    let generatedKeypair = null;
    let currentTab = 'orderbook';
    let orderbookData = { bids: [], asks: [] };
    let tradesData = [];
    let currentOfferId = null;
    let priceChart = null; // Chart.js instance
    
    // Sample offers data
    let myOffers = [
      { id: 1, xlm: 1.34, laam: 10, price: 0.134, type: 'buy' },
      { id: 2, xlm: 4.947, laam: 30, price: 0.1649, type: 'sell' }
    ];
    
    // Initialize Stellar SDK
    function initializeStellar() {
      try {
        if (typeof StellarSdk !== 'undefined') {
          server = new StellarSdk.Server('https://horizon.stellar.org');
          console.log('Stellar SDK initialized successfully');
        } else {
          console.error('Stellar SDK not loaded');
          showError('Stellar SDK failed to load. Please refresh the page.');
        }
      } catch (error) {
        console.error('Error initializing Stellar SDK:', error);
        showError('Failed to initialize Stellar SDK: ' + error.message);
      }
    }
    
    function initializeAssets() {
      try {
        if (typeof StellarSdk !== 'undefined') {
          LAAM_ASSET = new StellarSdk.Asset(LAAM_TOKEN.code, LAAM_TOKEN.issuer);
          console.log('Assets initialized successfully');
        }
      } catch (error) {
        console.error('Error initializing assets:', error);
      }
    }
    
    // Utility functions
    function showError(message) {
      alert('Error: ' + message);
    }
    
    function showSuccess(message) {
      alert('Success: ' + message);
    }
    
    function formatAmount(amount) {
      return parseFloat(amount).toFixed(7);
    }
    
    function encryptSecretKey(secretKey, password) {
      return CryptoJS.AES.encrypt(secretKey, password).toString();
    }
    
    function decryptSecretKey(encryptedKey, password) {
      try {
        const bytes = CryptoJS.AES.decrypt(encryptedKey, password);
        return bytes.toString(CryptoJS.enc.Utf8);
      } catch (e) {
        return null;
      }
    }

    // Copy to clipboard function
    async function copyToClipboard(elementId, buttonElement) {
      try {
        const element = document.getElementById(elementId);
        const text = element.value;
        
        await navigator.clipboard.writeText(text);
        
        const originalText = buttonElement.textContent;
        buttonElement.textContent = 'Copied!';
        buttonElement.classList.add('copied');
        
        setTimeout(() => {
          buttonElement.textContent = originalText;
          buttonElement.classList.remove('copied');
        }, 2000);
        
      } catch (err) {
        console.error('Failed to copy:', err);
        const element = document.getElementById(elementId);
        element.select();
        element.setSelectionRange(0, 99999);
        document.execCommand('copy');
        
        const originalText = buttonElement.textContent;
        buttonElement.textContent = 'Copied!';
        buttonElement.classList.add('copied');
        
        setTimeout(() => {
          buttonElement.textContent = originalText;
          buttonElement.classList.remove('copied');
        }, 2000);
      }
    }

    // Key modal functions
    function openKeyModal(secretKey, publicKey) {
      document.getElementById('generatedSecretKey').value = secretKey;
      document.getElementById('generatedPublicKey').value = publicKey;
      document.getElementById('keyModal').classList.add('show');
    }

    function closeKeyModal() {
      document.getElementById('keyModal').classList.remove('show');
      generatedKeypair = null;
    }

    function useGeneratedAccount() {
      if (generatedKeypair) {
        document.getElementById('secretKeyInput').value = generatedKeypair.secret();
        closeKeyModal();
        showSuccess('Account keys have been filled in the form. Please create a password to save your wallet.');
      }
    }

    // My Offers functions
    function refreshMyOffers() {
      console.log('Refreshing my offers...');
      loadMyOffers();
    }

    function loadMyOffers() {
      const tbody = document.getElementById('myOffersBody');
      tbody.innerHTML = '';
      
      if (myOffers.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" class="no-offers">No offers found</td></tr>';
        return;
      }
      
      myOffers.forEach(offer => {
        const row = document.createElement('tr');
        row.className = 'offer-row';
        row.innerHTML = `
          <td class="offer-amount">${offer.xlm}</td>
          <td class="offer-amount">${offer.laam}</td>
          <td class="offer-price">${offer.price}</td>
          <td>
            <div class="offer-actions">
              <button class="offer-action-btn edit-btn" onclick="editOffer(${offer.id})" title="Edit">✏️</button>
              <button class="offer-action-btn delete-btn" onclick="deleteOffer(${offer.id})" title="Delete">✖️</button>
            </div>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function editOffer(offerId) {
      const offer = myOffers.find(o => o.id === offerId);
      if (!offer) {
        showError('Offer not found');
        return;
      }
      
      const newLaam = prompt(`Edit Laam amount (current: ${offer.laam}):`, offer.laam);
      if (newLaam === null) return;
      
      const newPrice = prompt(`Edit price (current: ${offer.price}):`, offer.price);
      if (newPrice === null) return;
      
      const laamAmount = parseFloat(newLaam);
      const price = parseFloat(newPrice);
      
      if (isNaN(laamAmount) || isNaN(price) || laamAmount <= 0 || price <= 0) {
        showError('Please enter valid positive numbers');
        return;
      }
      
      offer.laam = laamAmount;
      offer.price = price;
      offer.xlm = (laamAmount * price).toFixed(3);
      
      loadMyOffers();
      showSuccess('Offer updated successfully!');
    }

    function deleteOffer(offerId) {
      if (!confirm('Are you sure you want to delete this offer?')) {
        return;
      }
      
      const index = myOffers.findIndex(o => o.id === offerId);
      if (index === -1) {
        showError('Offer not found');
        return;
      }
      
      myOffers.splice(index, 1);
      loadMyOffers();
      showSuccess('Offer deleted successfully!');
    }

    // Tab switching functionality
    function switchTab(tabName) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      
      document.getElementById(tabName + 'Tab').classList.add('active');
      document.getElementById(tabName + 'Content').classList.add('active');
      
      currentTab = tabName;
      
      if (tabName === 'orderbook') {
        fetchOrderbook();
      } else if (tabName === 'lastTrades') {
        fetchTrades();
      } else if (tabName === 'overview') {
        updateOverview();
      }
    }

    // Fetch XLM price from API
    async function fetchXLMPrice() {
      try {
        const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=stellar&vs_currencies=usd');
        const data = await response.json();
        if (data.stellar && data.stellar.usd) {
          xlmPriceUSD = data.stellar.usd;
          console.log('XLM price updated:', xlmPriceUSD);
        }
      } catch (error) {
        console.error('Error fetching XLM price:', error);
        xlmPriceUSD = 0.12;
      }
    }

    // Create a beautiful price chart
    function createPriceChart() {
      const ctx = document.getElementById('priceChart').getContext('2d');
      
      // Sample price data (in a real app, this would come from an API)
      const prices = [0.12, 0.125, 0.128, 0.13, 0.132, 0.135, 0.133, 0.131, 0.129, 0.127, 0.125, 0.128, 0.13, 0.132, 0.135];
      const labels = Array.from({length: prices.length}, (_, i) => {
        const d = new Date();
        d.setHours(d.getHours() - (prices.length - i - 1));
        return d.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
      });
      
      // Destroy existing chart if it exists
      if (priceChart) {
        priceChart.destroy();
      }
      
      priceChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'LAAM/XLM Price',
            data: prices,
            borderColor: '#1976d2',
            backgroundColor: 'rgba(25, 118, 210, 0.1)',
            borderWidth: 2,
            pointRadius: 3,
            pointBackgroundColor: '#1976d2',
            pointBorderColor: '#fff',
            pointHoverRadius: 5,
            fill: true,
            tension: 0.3
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              mode: 'index',
              intersect: false,
              backgroundColor: 'rgba(0, 0, 0, 0.7)',
              titleFont: {
                size: 14
              },
              bodyFont: {
                size: 13
              }
            }
          },
          scales: {
            x: {
              grid: {
                display: false
              },
              ticks: {
                maxRotation: 0,
                autoSkip: true,
                maxTicksLimit: 6
              }
            },
            y: {
              grid: {
                color: 'rgba(0, 0, 0, 0.05)'
              },
              ticks: {
                callback: function(value) {
                  return value.toFixed(3) + ' XLM';
                }
              }
            }
          },
          interaction: {
            intersect: false,
            mode: 'index',
          }
        }
      });
    }

    // Update overview tab
    function updateOverview() {
      const currentPrice = 0.135000;
      const priceChange = 0.005000;
      const priceChangePercent = ((priceChange / (currentPrice - priceChange)) * 100).toFixed(2);
      
      document.getElementById('overviewLaamPriceXLM').textContent = currentPrice.toFixed(6);
      
      const priceChangeElement = document.getElementById('priceChange');
      priceChangeElement.textContent = `+${priceChange.toFixed(6)} (+${priceChangePercent}%)`;
      priceChangeElement.className = priceChange >= 0 ? 'price-change positive' : 'price-change negative';
      
      // Create or update the price chart
      createPriceChart();
    }

    // Fetch orderbook data
    async function fetchOrderbook() {
      try {
        console.log('Fetching orderbook data...');
        
        document.getElementById('asksBody').innerHTML = '<tr><td colspan="3" style="text-align:center; padding:20px;"><div class="loading-spinner"></div> Loading asks...</td></tr>';
        document.getElementById('bidsBody').innerHTML = '<tr><td colspan="3" style="text-align:center; padding:20px;"><div class="loading-spinner"></div> Loading bids...</td></tr>';
        document.getElementById('spreadValue').innerHTML = '<div class="loading-spinner"></div> Loading spread...';
        
        const orderbookUrl = `https://horizon.stellar.org/order_book?selling_asset_type=credit_alphanum4&selling_asset_code=${LAAM_TOKEN.code}&selling_asset_issuer=${LAAM_TOKEN.issuer}&buying_asset_type=native&limit=10`;
        
        const response = await fetch(orderbookUrl);
        const data = await response.json();
        
        console.log('Orderbook data received:', data);
        
        document.getElementById('asksBody').innerHTML = '';
        document.getElementById('bidsBody').innerHTML = '';
        
        const asksBody = document.getElementById('asksBody');
        if (data.asks && data.asks.length > 0) {
          orderbookData.asks = data.asks;
          data.asks.slice(0, 5).forEach(ask => {
            const row = document.createElement('tr');
            row.className = 'ask-row';
            const amount = parseFloat(ask.amount).toFixed(2);
            const price = parseFloat(ask.price).toFixed(7);
            const total = (parseFloat(ask.amount) * parseFloat(ask.price)).toFixed(7);
            
            row.innerHTML = `
              <td>${amount}</td>
              <td>${price}</td>
              <td>${total}</td>
            `;
            
            row.addEventListener('click', () => {
              if (document.getElementById('tradeModal').classList.contains('show')) {
                document.getElementById('modalPrice').value = price;
                calculateTotal();
              }
            });
            
            asksBody.appendChild(row);
          });
        } else {
          const sampleAsks = [
            { amount: '1000.00', price: '0.1450000', total: '145.0000000' },
            { amount: '750.00', price: '0.1400000', total: '105.0000000' },
            { amount: '500.00', price: '0.1380000', total: '69.0000000' },
            { amount: '1200.00', price: '0.1360000', total: '163.2000000' },
            { amount: '800.00', price: '0.1350000', total: '108.0000000' }
          ];
          
          sampleAsks.forEach(ask => {
            const row = document.createElement('tr');
            row.className = 'ask-row';
            row.innerHTML = `
              <td>${ask.amount}</td>
              <td>${ask.price}</td>
              <td>${ask.total}</td>
            `;
            
            row.addEventListener('click', () => {
              if (document.getElementById('tradeModal').classList.contains('show')) {
                document.getElementById('modalPrice').value = ask.price;
                calculateTotal();
              }
            });
            
            asksBody.appendChild(row);
          });
        }
        
        const bidsBody = document.getElementById('bidsBody');
        if (data.bids && data.bids.length > 0) {
          orderbookData.bids = data.bids;
          data.bids.slice(0, 5).forEach(bid => {
            const row = document.createElement('tr');
            row.className = 'bid-row';
            const amount = parseFloat(bid.amount).toFixed(2);
            const price = parseFloat(bid.price).toFixed(7);
            const total = (parseFloat(bid.amount) * parseFloat(bid.price)).toFixed(7);
            
            row.innerHTML = `
              <td>${amount}</td>
              <td>${price}</td>
              <td>${total}</td>
            `;
            
            row.addEventListener('click', () => {
              if (document.getElementById('tradeModal').classList.contains('show')) {
                document.getElementById('modalPrice').value = price;
                calculateTotal();
              }
            });
            
            bidsBody.appendChild(row);
          });
        } else {
          const sampleBids = [
            { amount: '900.00', price: '0.1300000', total: '117.0000000' },
            { amount: '1100.00', price: '0.1280000', total: '140.8000000' },
            { amount: '600.00', price: '0.1250000', total: '75.0000000' },
            { amount: '1500.00', price: '0.1220000', total: '183.0000000' },
            { amount: '700.00', price: '0.1200000', total: '84.0000000' }
          ];
          
          sampleBids.forEach(bid => {
            const row = document.createElement('tr');
            row.className = 'bid-row';
            row.innerHTML = `
              <td>${bid.amount}</td>
              <td>${bid.price}</td>
              <td>${bid.total}</td>
            `;
            
            row.addEventListener('click', () => {
              if (document.getElementById('tradeModal').classList.contains('show')) {
                document.getElementById('modalPrice').value = bid.price;
                calculateTotal();
              }
            });
            
            bidsBody.appendChild(row);
          });
        }
        
        let spread = 'No data';
        if (data.asks && data.asks.length > 0 && data.bids && data.bids.length > 0) {
          const bestAsk = parseFloat(data.asks[0].price);
          const bestBid = parseFloat(data.bids[0].price);
          const spreadValue = bestAsk - bestBid;
          const spreadPercent = ((spreadValue / bestBid) * 100).toFixed(2);
          spread = `Spread: ${spreadValue.toFixed(7)} XLM (${spreadPercent}%)`;
        } else {
          spread = 'Spread: 0.0150000 XLM (11.54%)';
        }
        
        document.getElementById('spreadValue').textContent = spread;
        
        console.log('Orderbook updated successfully');
        
      } catch (error) {
        console.error('Error fetching orderbook:', error);
        
        document.getElementById('asksBody').innerHTML = `
          <tr class="ask-row"><td>1000.00</td><td>0.1450000</td><td>145.0000000</td></tr>
          <tr class="ask-row"><td>750.00</td><td>0.1400000</td><td>105.0000000</td></tr>
          <tr class="ask-row"><td>500.00</td><td>0.1380000</td><td>69.0000000</td></tr>
          <tr class="ask-row"><td>1200.00</td><td>0.1360000</td><td>163.2000000</td></tr>
          <tr class="ask-row"><td>800.00</td><td>0.1350000</td><td>108.0000000</td></tr>
        `;
        
        document.getElementById('bidsBody').innerHTML = `
          <tr class="bid-row"><td>900.00</td><td>0.1300000</td><td>117.0000000</td></tr>
          <tr class="bid-row"><td>1100.00</td><td>0.1280000</td><td>140.8000000</td></tr>
          <tr class="bid-row"><td>600.00</td><td>0.1250000</td><td>75.0000000</td></tr>
          <tr class="bid-row"><td>1500.00</td><td>0.1220000</td><td>183.0000000</td></tr>
          <tr class="bid-row"><td>700.00</td><td>0.1200000</td><td>84.0000000</td></tr>
        `;
        
        document.getElementById('spreadValue').textContent = 'Spread: 0.0150000 XLM (11.54%)';
        
        document.querySelectorAll('.ask-row, .bid-row').forEach(row => {
          row.addEventListener('click', () => {
            const price = row.children[1].textContent;
            if (document.getElementById('tradeModal').classList.contains('show')) {
              document.getElementById('modalPrice').value = price;
              calculateTotal();
            }
          });
        });
      }
    }

    // Fetch trades data
    async function fetchTrades() {
      try {
        console.log('Fetching trades data...');
        
        document.getElementById('tradesBody').innerHTML = '<tr><td colspan="4" style="text-align:center; padding:20px;"><div class="loading-spinner"></div> Loading trades...</td></tr>';
        
        const tradesUrl = `https://horizon.stellar.org/trades?base_asset_type=credit_alphanum4&base_asset_code=${LAAM_TOKEN.code}&base_asset_issuer=${LAAM_TOKEN.issuer}&counter_asset_type=native&limit=20&order=desc`;
        
        const response = await fetch(tradesUrl);
        const data = await response.json();
        
        console.log('Trades data received:', data);
        
        const tradesBody = document.getElementById('tradesBody');
        tradesBody.innerHTML = '';
        
        if (data._embedded && data._embedded.records && data._embedded.records.length > 0) {
          tradesData = data._embedded.records;
          data._embedded.records.slice(0, 10).forEach(trade => {
            const row = document.createElement('tr');
            const time = new Date(trade.ledger_close_time).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            const type = trade.base_is_seller ? 'sell' : 'buy';
            const price = parseFloat(trade.price.n / trade.price.d).toFixed(7);
            const amount = parseFloat(trade.base_amount).toFixed(2);
            
            row.innerHTML = `
              <td class="trade-time">${time}</td>
              <td class="trade-${type}">${type.toUpperCase()}</td>
              <td>${price}</td>
              <td>${amount}</td>
            `;
            
            tradesBody.appendChild(row);
          });
        } else {
          const sampleTrades = [
            { time: '14:32', type: 'buy', price: '0.1350000', amount: '150.00' },
            { time: '14:28', type: 'sell', price: '0.1340000', amount: '200.00' },
            { time: '14:25', type: 'buy', price: '0.1345000', amount: '75.00' },
            { time: '14:20', type: 'sell', price: '0.1330000', amount: '300.00' },
            { time: '14:15', type: 'buy', price: '0.1335000', amount: '125.00' }
          ];
          
          sampleTrades.forEach(trade => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td class="trade-time">${trade.time}</td>
              <td class="trade-${trade.type}">${trade.type.toUpperCase()}</td>
              <td>${trade.price}</td>
              <td>${trade.amount}</td>
            `;
            tradesBody.appendChild(row);
          });
        }
        
        console.log('Trades updated successfully');
        
      } catch (error) {
        console.error('Error fetching trades:', error);
        
        const tradesBody = document.getElementById('tradesBody');
        tradesBody.innerHTML = `
          <tr><td class="trade-time">14:32</td><td class="trade-buy">BUY</td><td>0.1350000</td><td>150.00</td></tr>
          <tr><td class="trade-time">14:28</td><td class="trade-sell">SELL</td><td>0.1340000</td><td>200.00</td></tr>
          <tr><td class="trade-time">14:25</td><td class="trade-buy">BUY</td><td>0.1345000</td><td>75.00</td></tr>
          <tr><td class="trade-time">14:20</td><td class="trade-sell">SELL</td><td>0.1330000</td><td>300.00</td></tr>
          <tr><td class="trade-time">14:15</td><td class="trade-buy">BUY</td><td>0.1335000</td><td>125.00</td></tr>
        `;
      }
    }

    // Trade modal functions
    function openTradeModal(mode) {
      currentTradeMode = mode;
      const modal = document.getElementById('tradeModal');
      const title = document.getElementById('modalTitle');
      const panelTitle = document.getElementById('panelTitle');
      const buyBtn = document.getElementById('modalBuyBtn');
      
      if (mode === 'buy') {
        title.textContent = 'Buy Laam';
        panelTitle.textContent = 'Buy Laam';
        buyBtn.textContent = 'Buy Laam';
        buyBtn.className = 'cta buy';
        document.getElementById('availBalance').textContent = '0 XLM';
      } else {
        title.textContent = 'Sell Laam';
        panelTitle.textContent = 'Sell Laam';
        buyBtn.textContent = 'Sell Laam';
        buyBtn.className = 'cta sell';
        document.getElementById('availBalance').textContent = '0 Laam';
      }
      
      modal.classList.add('show');
      
      // Set default price from orderbook
      if (currentTab === 'orderbook') {
        if (mode === 'buy' && orderbookData.asks.length > 0) {
          document.getElementById('modalPrice').value = parseFloat(orderbookData.asks[0].price).toFixed(7);
        } else if (mode === 'sell' && orderbookData.bids.length > 0) {
          document.getElementById('modalPrice').value = parseFloat(orderbookData.bids[0].price).toFixed(7);
        }
      }
      
      calculateTotal();
    }

    function closeTradeModal() {
      document.getElementById('tradeModal').classList.remove('show');
      document.getElementById('modalPrice').value = '';
      document.getElementById('modalAmount').value = '';
      document.getElementById('modalTotal').value = '';
    }

    function calculateTotal() {
      const price = parseFloat(document.getElementById('modalPrice').value) || 0;
      const amount = parseFloat(document.getElementById('modalAmount').value) || 0;
      const total = price * amount;
      document.getElementById('modalTotal').value = total.toFixed(7);
    }

    // My Orders Modal functions
    function openMyOrdersModal() {
      document.getElementById('myOrdersModal').classList.add('show');
      loadMyOrders();
    }

    function closeMyOrdersModal() {
      document.getElementById('myOrdersModal').classList.remove('show');
    }

    function loadMyOrders() {
      const ordersList = document.getElementById('ordersList');
      ordersList.innerHTML = '<div style="text-align:center; padding:20px; color:#666;">No active orders found</div>';
    }

    function promptEditOffer() {
      showError('Please select an order first');
    }

    function confirmCancelOffer() {
      showError('Please select an order first');
    }

    function closeEditModal() {
      document.getElementById('editOrderModal').classList.remove('show');
    }

    // Wallet storage keys
    const STORAGE_KEYS = { encSecret: 'laam_enc_sk', pub: 'laam_pub', hint: 'laam_hint' };

    function toggleAuth(showAuth) {
      document.getElementById('authSection').classList.toggle('hidden', !showAuth);
      document.getElementById('loggedInView').classList.toggle('hidden', showAuth);
    }

    async function fetchBalances(publicKey) {
      try {
        if (!server) initializeStellar();
        const account = await server.loadAccount(publicKey);
        let xlm = 0, laam = 0;
        account.balances.forEach(b => {
          if (b.asset_type === 'native') xlm = parseFloat(b.balance);
          if (b.asset_code === LAAM_TOKEN.code && b.asset_issuer === LAAM_TOKEN.issuer) laam = parseFloat(b.balance);
        });
        document.getElementById('xlmBal').textContent = xlm.toFixed(2);
        document.getElementById('laamBal').textContent = laam.toFixed(2);
        document.getElementById('xlmPrice').textContent = xlmPriceUSD.toFixed(2);
        const laamPrice = 0.06; // placeholder
        document.getElementById('laamPrice').textContent = laamPrice.toFixed(2);
        document.getElementById('xlmUsd').textContent = (xlm * xlmPriceUSD).toFixed(2);
        document.getElementById('laamUsd').textContent = (laam * laamPrice).toFixed(2);
      } catch (e) {
        console.warn('Failed to fetch balances:', e);
      }
    }

    function afterLoginSetup() {
      // show public key
      document.getElementById('pubKey').textContent = currentKeypair ? currentKeypair.publicKey() : '-';
      toggleAuth(false);
      fetchBalances(currentKeypair.publicKey());
      // load sections
      fetchOrderbook();
      loadMyOffers();
    }

    // Import and save wallet
    function importAndSaveWallet() {
      try {
        const secret = document.getElementById('secretKeyInput').value.trim();
        const password = document.getElementById('savePasswordInput').value;
        if (!secret || !secret.startsWith('S')) return showError('Gali Secret Key sax ah (S...)');
        if (!password || password.length < 8) return showError('Password-ku ha ahaado ugu yaraan 8 xaraf');
        const kp = StellarSdk.Keypair.fromSecret(secret);
        const enc = encryptSecretKey(secret, password);
        localStorage.setItem(STORAGE_KEYS.encSecret, enc);
        localStorage.setItem(STORAGE_KEYS.pub, kp.publicKey());
        localStorage.setItem(STORAGE_KEYS.hint, 'exists');
        currentKeypair = kp;
        showSuccess('Wallet-ka waa la kaydiyay oo waa la furay');
        afterLoginSetup();
      } catch (e) {
        console.error(e);
        showError('Secret key ma aha mid sax ah');
      }
    }

    // Generate new account (local only)
    function generateAccount() {
      try {
        generatedKeypair = StellarSdk.Keypair.random();
        openKeyModal(generatedKeypair.secret(), generatedKeypair.publicKey());
      } catch (e) {
        showError('Ku guuldareystay in la abuuro key cusub');
      }
    }

    function checkSavedWallet() {
      const enc = localStorage.getItem(STORAGE_KEYS.encSecret);
      if (enc) {
        document.getElementById('initialView').classList.add('hidden');
        document.getElementById('unlockView').classList.remove('hidden');
      } else {
        document.getElementById('unlockView').classList.add('hidden');
        document.getElementById('initialView').classList.remove('hidden');
      }
    }

    function unlockExistingWallet() {
      const enc = localStorage.getItem(STORAGE_KEYS.encSecret);
      const password = document.getElementById('walletPassword').value;
      if (!enc) return showError('Wax kayd ah lama helin');
      if (!password) return showError('Geli password-ka');
      const secret = decryptSecretKey(enc, password);
      if (!secret || !secret.startsWith('S')) return showError('Password khaldan ama xog xun');
      try {
        currentKeypair = StellarSdk.Keypair.fromSecret(secret);
        showSuccess('Wallet waa la furay');
        afterLoginSetup();
      } catch (e) {
        showError('Secret key sax ma aha');
      }
    }

    function lockWallet() {
      currentKeypair = null;
      document.getElementById('walletPassword').value = '';
      toggleAuth(true);
      checkSavedWallet();
    }

    function resetWalletStorage() {
      localStorage.removeItem(STORAGE_KEYS.encSecret);
      localStorage.removeItem(STORAGE_KEYS.pub);
      localStorage.removeItem(STORAGE_KEYS.hint);
      document.getElementById('secretKeyInput').value = '';
      document.getElementById('savePasswordInput').value = '';
      document.getElementById('unlockView').classList.add('hidden');
      document.getElementById('initialView').classList.remove('hidden');
    }

    // Simple UI bindings
    function bindUIBasics() {
      const sendToggle = document.getElementById('btnSendToggle');
      if (sendToggle) {
        sendToggle.addEventListener('click', () => {
          const el = document.getElementById('sendForm');
          el.style.display = el.style.display === 'block' ? 'none' : 'block';
        });
      }
      const logoutBtn = document.getElementById('logoutBtn');
      if (logoutBtn) logoutBtn.addEventListener('click', lockWallet);
      const unlockBtn = document.getElementById('unlockBtn');
      if (unlockBtn) unlockBtn.addEventListener('click', unlockExistingWallet);
      const resetLink = document.getElementById('resetWalletLink');
      if (resetLink) resetLink.addEventListener('click', function(e){ e.preventDefault(); resetWalletStorage(); });
    }

    // Initialize the application
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM loaded, initializing app...');
      
      initializeStellar();
      initializeAssets();
      fetchXLMPrice();
      checkSavedWallet();
      bindUIBasics();
      
      // Load my offers on page load
      loadMyOffers();
      
      document.getElementById('importAndSaveBtn').addEventListener('click', importAndSaveWallet);
      document.getElementById('generateAccountBtn').addEventListener('click', generateAccount);
      
      // Tab event listeners
      document.getElementById('overviewTab').addEventListener('click', () => switchTab('overview'));
      document.getElementById('orderbookTab').addEventListener('click', () => switchTab('orderbook'));
      document.getElementById('lastTradesTab').addEventListener('click', () => switchTab('lastTrades'));
      
      // Trade button event listeners
      document.getElementById('btnBuy').addEventListener('click', () => openTradeModal('buy'));
      document.getElementById('btnSell').addEventListener('click', () => openTradeModal('sell'));
      
      // Modal input event listeners
      document.getElementById('modalPrice').addEventListener('input', calculateTotal);
      document.getElementById('modalAmount').addEventListener('input', calculateTotal);
      
      // Fill percentage buttons
      document.querySelectorAll('[data-fill]').forEach(btn => {
        btn.addEventListener('click', function() {
          const percentage = parseInt(this.dataset.fill);
          const availableBalance = 100; // This would come from actual balance
          const amount = (availableBalance * percentage / 100).toFixed(2);
          document.getElementById('modalAmount').value = amount;
          calculateTotal();
        });
      });
      
      // Load initial orderbook
      fetchOrderbook();
      
      console.log('App initialized successfully');
    });
  </script>
</body>
</html>
